services:
  # ==================================================
  # LightRAG Nano instanssit (7 kpl)
  # ==================================================

  lightrag-nano-1:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-1
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "9621:9621"
    volumes:
      - ./data/nano1/rag_storage:/app/data/rag_storage
      - ./data/nano1/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-1
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks: [stack-net]

  lightrag-nano-2:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-2
    ports: ["9622:9621"]
    volumes:
      - ./data/nano2/rag_storage:/app/data/rag_storage
      - ./data/nano2/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-2
    restart: unless-stopped
    extra_hosts: ["host.docker.internal:host-gateway"]
    networks: [stack-net]

  lightrag-nano-3:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-3
    ports: ["9623:9621"]
    volumes:
      - ./data/nano3/rag_storage:/app/data/rag_storage
      - ./data/nano3/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-3
    restart: unless-stopped
    extra_hosts: ["host.docker.internal:host-gateway"]
    networks: [stack-net]

  lightrag-nano-4:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-4
    ports: ["9624:9621"]
    volumes:
      - ./data/nano4/rag_storage:/app/data/rag_storage
      - ./data/nano4/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-4
    restart: unless-stopped
    extra_hosts: ["host.docker.internal:host-gateway"]
    networks: [stack-net]

  lightrag-nano-5:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-5
    ports: ["9625:9621"]
    volumes:
      - ./data/nano5/rag_storage:/app/data/rag_storage
      - ./data/nano5/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-5
    restart: unless-stopped
    extra_hosts: ["host.docker.internal:host-gateway"]
    networks: [stack-net]

  lightrag-nano-6:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-6
    ports: ["9626:9621"]
    volumes:
      - ./data/nano6/rag_storage:/app/data/rag_storage
      - ./data/nano6/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-6
    restart: unless-stopped
    extra_hosts: ["host.docker.internal:host-gateway"]
    networks: [stack-net]

  lightrag-nano-7:
    image: ghcr.io/hkuds/lightrag:latest
    container_name: lightrag-nano-7
    ports: ["9627:9621"]
    volumes:
      - ./data/nano7/rag_storage:/app/data/rag_storage
      - ./data/nano7/inputs:/app/data/inputs
      - ./config.ini:/app/config.ini
      - ./.env:/app/.env
    env_file: [.env]
    environment:
      - INSTANCE_ID=nano-7
    restart: unless-stopped
    extra_hosts: ["host.docker.internal:host-gateway"]
    networks: [stack-net]

  # ==================================================
  # Nano Agentit (7 kpl)
  # ==================================================

  agent-1:
    build: ./agent
    container_name: nano-agent-1
    ports: ["9001:9000"]
    volumes:
      - ./agent/data/agent1:/data
    depends_on: [lightrag-nano-1]
    environment:
      - AGENT_ID=agent-1
      - LIGHTRAG_URL=http://lightrag-nano-1:9621/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  agent-2:
    build: ./agent
    container_name: nano-agent-2
    ports: ["9002:9000"]
    volumes:
      - ./agent/data/agent2:/data
    depends_on: [lightrag-nano-2]
    environment:
      - AGENT_ID=agent-2
      - LIGHTRAG_URL=http://lightrag-nano-2:9622/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  agent-3:
    build: ./agent
    container_name: nano-agent-3
    ports: ["9003:9000"]
    volumes:
      - ./agent/data/agent3:/data
    depends_on: [lightrag-nano-3]
    environment:
      - AGENT_ID=agent-3
      - LIGHTRAG_URL=http://lightrag-nano-3:9623/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  agent-4:
    build: ./agent
    container_name: nano-agent-4
    ports: ["9004:9000"]
    volumes:
      - ./agent/data/agent4:/data
    depends_on: [lightrag-nano-4]
    environment:
      - AGENT_ID=agent-4
      - LIGHTRAG_URL=http://lightrag-nano-4:9624/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  agent-5:
    build: ./agent
    container_name: nano-agent-5
    ports: ["9005:9000"]
    volumes:
      - ./agent/data/agent5:/data
    depends_on: [lightrag-nano-5]
    environment:
      - AGENT_ID=agent-5
      - LIGHTRAG_URL=http://lightrag-nano-5:9625/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  agent-6:
    build: ./agent
    container_name: nano-agent-6
    ports: ["9006:9000"]
    volumes:
      - ./agent/data/agent6:/data
    depends_on: [lightrag-nano-6]
    environment:
      - AGENT_ID=agent-6
      - LIGHTRAG_URL=http://lightrag-nano-6:9626/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  agent-7:
    build: ./agent
    container_name: nano-agent-7
    ports: ["9007:9000"]
    volumes:
      - ./agent/data/agent7:/data
    depends_on: [lightrag-nano-7]
    environment:
      - AGENT_ID=agent-7
      - LIGHTRAG_URL=http://lightrag-nano-7:9627/query
      - ALLOWED_ORIGINS=*
      - API_KEY=your-secure-api-key-here-marko
      - BEARER_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2ODI1MzYwMiwicm9sZSI6InVzZXIiLCJtZXRhZGF0YSI6eyJhdXRoX21vZGUiOiJlbmFibGVkIn19.fxKmezvmn8z8eH55kWczgzzXXwplzASyOo5_Y9uoV_k
    restart: unless-stopped
    networks: [stack-net]

  # ==================================================
  # UI:t
  # ==================================================

  enduser-app:
    build: ./apps/enduser-app
    container_name: enduser-app
    ports: ["3000:80"]
    depends_on: [agent-1]
    restart: unless-stopped
    networks: [stack-net]

  dolmusai-app:
    build: ./apps/dolmusai-app
    container_name: dolmusai-app
    ports: ["3333:80"]
    depends_on: [agent-1]
    restart: unless-stopped
    networks: [stack-net]

  admin-app:
    build: ./apps/admin-app
    container_name: admin-app
    ports: ["3099:80"]
    depends_on: [agent-1]
    restart: unless-stopped
    networks: [stack-net]

  enduser-app2:
    build: ./apps/enduser-app2
    container_name: enduser-app2
    ports: ["3002:80"]
    depends_on: [agent-2]
    restart: unless-stopped
    networks: [stack-net]

  enduser-app3:
    build: ./apps/enduser-app3
    container_name: enduser-app3
    ports: ["3003:80"]
    depends_on: [agent-3]
    restart: unless-stopped
    networks: [stack-net]

  enduser-app4:
    build: ./apps/enduser-app4
    container_name: enduser-app4
    ports: ["3004:80"]
    depends_on: [agent-4]
    restart: unless-stopped
    networks: [stack-net]

  enduser-app5:
    build: ./apps/enduser-app5
    container_name: enduser-app5
    ports: ["3005:80"]
    depends_on: [agent-5]
    restart: unless-stopped
    networks: [stack-net]

  enduser-app6:
    build: ./apps/enduser-app6
    container_name: enduser-app6
    ports: ["3006:80"]
    depends_on: [agent-6]
    restart: unless-stopped
    networks: [stack-net]

  enduser-app7:
    build: ./apps/enduser-app7
    container_name: enduser-app7
    ports: ["3007:80"]
    depends_on: [agent-7]
    restart: unless-stopped
    networks: [stack-net]

  nanolab-app:
    build: ./apps/nanolab-app
    container_name: nanolab-app
    ports: ["3033:80"]
    restart: unless-stopped
    networks: [stack-net]

networks:
  stack-net:
    driver: bridge
